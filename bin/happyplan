#!/usr/bin/env node

'use strict';

var packagePath = 'node_modules/happyplan';

// Internal libs.
var options = require('../lib/cli').options;
var info = require('../lib/info');

var localHappyplanExist = require('fs').existsSync(packagePath);

// Do stuff based on CLI options.
if (options.version) {
  info.version(localHappyplanExist ? process.cwd() + '/' + packagePath + '/package.json' : null);
}

if (!localHappyplanExist) {
  info.fatal('Unable to find local package ' + packagePath + '.', 99);
}

// launch grunt from happyplan dir, & pass the current cwd
var args = [];
var opts = [];

// prefix all command with happyplan:
process.argv.slice(2).forEach(function(arg) {
	if (arg.indexOf('-') === 0) {
		opts.push(arg);
	}
	else {
		args.push('happyplan:' + arg);
	}
});

// add default command if needed
if (args.length === 0) {
	args.push('happyplan:default');
}

args = args.concat(opts);

// add appropriate cwd
args.push('--base');
args.push(process.cwd());

require('child_process').spawn('grunt', args, {
  cwd: packagePath,
  stdio: 'inherit'
}).on('close', function (code) {
  process.exit(code);
});
